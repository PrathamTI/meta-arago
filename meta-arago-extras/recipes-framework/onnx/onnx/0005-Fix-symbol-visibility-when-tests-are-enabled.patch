From 20751f4daf96566edc3b503c0e697f01f2b97263 Mon Sep 17 00:00:00 2001
From: Pratham Deshmukh <p-deshmukh@ti.com>
Date: Thu, 12 Feb 2026 17:27:17 +0530
Subject: [PATCH 5/5] Fix symbol visibility when tests are enabled

The onnx target uses hidden visibility which hides C++ API symbols
that tests need. Most C++ API symbols (OpSchema methods, OpSchemaRegistry
functions, etc.) are not marked with ONNX_API, so they remain hidden
even with ONNX_API_DEFINE set.

When tests are enabled, we need access to these internal symbols,
so disable hidden visibility for the main onnx library.

Upstream-Status: Pending

Signed-off-by: Pratham Deshmukh <p-deshmukh@ti.com>
---
 CMakeLists.txt | 2 --
 1 file changed, 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 89d4fed84..c4cded129 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -538,8 +538,6 @@ if(CMAKE_SYSTEM_NAME STREQUAL "AIX")
 else()
   add_library(onnx ${ONNX_SRCS})
 endif()
-set_target_properties(onnx PROPERTIES CXX_VISIBILITY_PRESET hidden)
-set_target_properties(onnx PROPERTIES VISIBILITY_INLINES_HIDDEN ON)
 
 target_include_directories(onnx PUBLIC
   $<BUILD_INTERFACE:${ONNX_ROOT}>
-- 
2.34.1

